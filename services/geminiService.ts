import { GoogleGenAI } from "@google/genai";

// Get API key from Vite environment variables
const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;

export const GeminiService = {
  async getConstructionAdvice(prompt: string, media?: { mimeType: string; data: string }): Promise<string> {
    if (!GEMINI_API_KEY) {
      console.error("Gemini API Key is not configured. Please set VITE_GEMINI_API_KEY in .env.local");
      return "๐ ฺฉูุฏ API ุชูุธู ูุดุฏู. ูุทูุง ุจุง ูพุดุชุจุงู ุชูุงุณ ุจฺฏุฑุฏ.";
    }

    const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });
    try {
      const parts: any[] = [{ text: prompt }];

      if (media) {
        parts.push({
          inlineData: {
            mimeType: media.mimeType,
            data: media.data
          }
        });
      }

      const response = await ai.models.generateContent({
        model: 'gemini-3-flash-preview',
        contents: { parts: parts },
        config: {
          systemInstruction: `ุดูุง ูููุฏุณ ุงุฑุดุฏ ู ูุดุงูุฑ ุชุฎุตุต ุจุงุฒุณุงุฒ (Renovation Specialist) ุฏุฑ ุดุฑฺฉุช "ูุฑูุณ ุณุงุฒู ุณุจุฒ" ูุณุชุฏ. 
          ุชุฎุตุต ุงุตู ุดูุง ุชุจุฏู ูุถุงูุง ูุฏูุ ูุฑุณูุฏู ู ุจโุฑูุญ ุจู ูุญุทโูุง ูุฏุฑูุ ููุดููุฏ ู ูพุงุฏุงุฑ (ุณุจุฒ) ุงุณุช.

          ูุธุงู ุดูุง:
          1. ุชุญูู ุชุตุงูุฑ ุงุฑุณุงู ุงุฒ ูุถุงูุง ุฏุงุฎู (ุขุดูพุฒุฎุงููุ ูพุฐุฑุงุ ุณุฑูุณโูุง) ู ุงุฑุงุฆู ูพุดููุงุฏุงุช ููุณุงุฒ.
          2. ุชุฎูู ูุฒููโูุง ุจุงุฒุณุงุฒ ุจุฑ ุงุณุงุณ ูุชุฑุงฺ ู ุณุทุญ ููฺฉุณ ุจูุฏู (ุงูุชุตุงุฏุ ุงุณุชุงูุฏุงุฑุฏุ VIP) ุจู ุชููุงู.
          3. ูพุดููุงุฏ ูุชุฑุงูโูุง ููู ฺฉู ุจุงุนุซ ุงูุฒุงุด ุงุฑุฒุด ููฺฉ ูโุดููุฏ.
          4. ุงุฑุงุฆู ุฒูุงูโุจูุฏ ุชูุฑุจ ุจุฑุง ูุฑุงุญู ุชุฎุฑุจุ ุชุงุณุณุงุช ู ูุงุฒฺฉโฺฉุงุฑ.
          
          ููุงูู ูพุงุณุฎฺฏู:
          - ููุดู ุจุง ูุญู ุญุฑููโุงุ ูููุฏุณ ู ุฏุฑ ุนู ุญุงู ุตูู ุจู ุฒุจุงู ูุงุฑุณ ูพุงุณุฎ ุฏูุฏ.
          - ุงุฒ ูุฑูุช Markdown ุจุฑุง ุฒุจุง ูุชู (ุชุชุฑูุงุ ูุณุชโูุง ู ุฌุฏุงูู) ุงุณุชูุงุฏู ฺฉูุฏ.
          - ุงฺฏุฑ ุชุตูุฑ ุงุฑุณุงู ุดุฏุ ุงุจุชุฏุง ููุงุท ุถุนู ูุถุง (ูุซู ููุฑ ฺฉูุ ฺุฏูุงู ุบูุทุ ูุฑุณูุฏฺฏ) ุฑุง ุดูุงุณุง ู ุณูพุณ ุฑุงูฺฉุงุฑ ุจุงุฒุณุงุฒ ุจุฏูุฏ.
          - ุฏุฑ ูพุงุงู ูุฑ ูุดุงูุฑูุ ฺฉุงุฑุจุฑ ุฑุง ุจู ุจุงุฒุฏุฏ ุญุถูุฑ ุฑุงฺฏุงู ุชูุณุท ุชู ูุฑูุณ ุชุดูู ฺฉูุฏ.
          `,
          temperature: 0.7,
        }
      });

      return response.text || "ูุชุงุณูุงูู ุฏุฑ ุญุงู ุญุงุถุฑ ูุงุฏุฑ ุจู ุชุญูู ูุณุชู. ูุทูุง ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ.";
    } catch (error) {
      console.error("Gemini API Error:", error);
      return "ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ ููุด ูุตููุน ูุฑูุณ ุฑุฎ ุฏุงุฏู ุงุณุช.";
    }
  }
};
